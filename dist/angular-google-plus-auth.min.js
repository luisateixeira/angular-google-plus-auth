/*! angular-google-plus-auth - v0.1.0 2015-02-15 */
angular.module("google.plus.auth",[]).factory("googlePlusUser",function(){var a=JSON.parse(localStorage.getItem("google.plus.auth.user"))||{};return angular.extend({},{profile:null,loggedIn:!1,authType:null},a)}).provider("googlePlusAuth",function(){function a(a){if(!a)throw new Error("Google Auth Provider - config() - The options parameter is required");if(!a.clientId)throw new Error("Google Auth Provider - config() - The clientId key is required");b=a.clientId,e=a.cookiePolicy||e,f=a.scope||f}var b,c,d,e="single_host_origin",f="https://www.googleapis.com/auth/plus.login https://www.googleapis.com/auth/userinfo.email",g="token id_token";return{config:a,$get:["$rootScope","$q","googlePlusUser",function(a,h,i){function j(){return l(!1).then(m)["catch"](o)}function k(){return gapi.auth.getToken()&&gapi.auth.getToken().status.signed_in?(gapi.auth.signOut(),l(!0)):o("User is already logged out")}function l(a){if(!b)throw new Error("Google Auth Provider - The clientId is not defined. Please define it in configuration options");return c=h.defer(),gapi.auth.authorize({immediate:a,response_type:g,client_id:b,cookie_policy:e,scope:f},n),c.promise}function m(){return d=h.defer(),gapi.client.load("oauth2","v2",function(){gapi.client.oauth2.userinfo.get().execute(function(a){a.error&&d.reject(a.error),d.resolve(q(a))})}),d.promise}function n(b){b.status.signed_in?"PROMPT"===b.status.method&&c.resolve(b):"user_signed_out"===b.error?(p(),c.resolve(b)):"immediate_failed"!==b.error&&c.reject(b.error),a.$apply()}function o(a){return p(),h.reject(a)}function p(){return i.profile=null,i.authType=null,i.loggedIn=!1,i}function q(a){return i.profile=a,i.authType="googlePlus",i.loggedIn=!0,i}return{login:j,logout:k,getAuth:l}}]}});